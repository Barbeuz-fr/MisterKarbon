<div class="container">
  <div class="d-flex justify-content-between">
    <%= link_to "Previous", new_report_report_scope_orga_path(@report), class:"btn btn-secondary mt-3" %>
    <%= link_to "Start your project!", report_path(@report.id), class:"btn btn-primary mt-3" %>
  </div>
</div>

<div class="container">
  <div class="row  mt-3 mb-3">
    <div class="col-8 ml-3">
      <h4>Add contributors to your project</h4>
      <h5>Project: <%= @report.name %> - <%= @report.year %> </h5>
    </div>
  </div>


<!-- Headers tableau -->
<!-- Organization - Emission module - Contributors - Add a contributor -->

  <div class="container mb-2">
    <div class="row">
      <div class="col-3">
        <div class="tab-header">
          <h3 class="text-center">Organization</h3>
        </div>
      </div>
      <div class="col-3">
        <div class="tab-header">
          <h3 class="text-center">Emission type</h3>
        </div>
      </div>
      <div class="col-3">
        <div class="tab-header">
          <h3 class="text-center">Team</h3>
        </div>
      </div>
      <div class="col-3">
        <% if params[:scope].present? %>
          <!-- Definition modale -->
          <div id="addEmail">
            <div class="tab-header">
              <h3 class="text-center">Add a contributor</h3>
            </div>
          </div>
        <% end %>
      </div>


<!-- Contenu du tableau avec bouton d'ajout de contributeur-->

<div class="container">
  <div class="row">
    <div class="col-9">
      <% @report.report_scopes.each do |report_scope|  %>
        <% report_scope.report_scope_orgas.each do |report_scope_orga| %>
          <div class="row">
            <!-- Nom de l'organisation -->
            <div class="col-4 flex-cell cell-white-background">
              <div class="bg-white">
                <p class="text-center"><%= report_scope_orga.orga.name %></p>
              </div>
            </div>
            <!-- Nom des emissions -->
            <div class="col-4 flex-cell cell-white-background">
              <p class="text-center"><%= report_scope.emission_module.name %></p>
            </div>
            <!-- Avatar des contributeurs et bouton "+" -->
            <div class="col-4 flex-cell cell-justify-left cell-white-background">
              <div class="mt-2 mb-2">
                <ul class= "m-0">
                  <% report_scope_orga.report_scope_orga_users.each do |report_scope_orga_user| %>
                    <% if report_scope_orga_user.user.photo.attached?  %>
                      <%= cl_image_tag report_scope_orga_user.user.photo.key, :crop=>"fill", class:"avatar ml-3", style:"width:50px; height:50px"%>
                    <% else %>
                      <%= image_tag "http://www.tafecafe.com/wp-content/uploads/2015/09/default_avatar.png", class:"avatar ml-3", style:"width:50px; height:50px"%>
                    <% end %>
                  <% end %>
                  <%= link_to "",
                            url_for(scope: report_scope_orga),
                            id: "addEmail",
                            class:"fas fa-plus-circle fa-1x" %>
                </ul>
              </div>
            </div>
            <!-- Panneaux d'ajout de user -->
          </div>
        <% end %>
      <% end %>
    </div>

    <!-- Modale pour ajout des contributeurs -->
    <div class="col-3">
      <% if params[:scope].present? %>
        <!-- Definition modale -->
        <div id="addEmail">
          <!-- Simple form barre de recherche-->
            <%= form_tag url_for(scope: params[:scope]), method: :get do %>
              <div class="input-group mb-3">
                <%= text_field_tag :query, params[:query], class:"form-control "%>
                <%= hidden_field_tag :scope, params[:scope]%>
              <div class="input-group-append">
                <%= submit_tag "ðŸ”Ž", class:"fas fa-search" %>
              </div>
            <% end %>

          <!-- Display resultats de la recherche -->
          <% if params[:scope].present? %>
              <div class="cardsemail">
                <% @results.each do |result| %>
                  <div class="card-email m-2">
                    <div class="email-card-body">
                      <div class="d-flex flex-row">
                        <div class="align-self-center">

                        <% if result.photo.attached?  %>
                          <%= cl_image_tag result.photo.key, :crop=>"fill", class:"avatar", style:"width:50px; height:50px"%>
                        <% else %>
                          <%= image_tag "http://www.tafecafe.com/wp-content/uploads/2015/09/default_avatar.png", class:"avatar", style:"width:40px; height:40px"%>
                        <% end %>
                        </div>
                        <div class="align-self-center pl-2">
                          <h5 class="card-title"><%= result.first_name %> <%= result.last_name %></h5>
                        </div>
                        <div class=" align-self-center pl-2">
                        <%= link_to "Add",
                                    report_scope_orga_report_scope_orga_users_path(params[:scope], report_scope_orga_user: { user_id: result.id }),
                                    method: :post,
                                    class: "btn btn-secondary btn-sm" %>
                        </div>
                      </div>
                      <p class="card-text margin-card-email smaller-text">
                        <%= result.email %>
                        </p>
                      <p class="card-text margin-card-email smaller-text">
                        <%= result.organization_position %> - <%= result.job_position %>
                      </p>
                      <p class="card-text margin-card-email smaller-text">
                        <%= result.company&.name %>
                      </p>
                      <!-- Bouton Add -->
                    </div>
                  </div>
                <% end %>
              </div>
          <% end %>
        </div>

      <% end %>
    </div>
  </div>
</div>
